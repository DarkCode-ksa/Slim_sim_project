#!/bin/bash
set -e

echo "بدء تثبيت SLiM..."

# التحقق من الأدوات (من conda)
for tool in git cmake g++ make; do
  if ! command -v "$tool" &> /dev/null; then
    echo "خطأ: $tool غير مثبت"
    exit 1
  fi
done

# استنساخ SLiM
rm -rf ~/SLiM
git clone --depth 1 https://github.com/MesserLab/SLiM.git ~/SLiM
cd ~/SLiM
mkdir build && cd build

# بناء
cmake .. -DCMAKE_BUILD_TYPE=Release
make -j$(nproc)

# تثبيت
mkdir -p ~/.local/bin
cp slim ~/.local/bin/slim
echo 'export PATH="$HOME/.local/bin:$PATH"' >> ~/.bashrc
export PATH="$HOME/.local/bin:$PATH"

echo "تم تثبيت SLiM في ~/.local/bin"
slim -version

# تثبيت pyslim
pip install pyslim msprime

echo "جاهز! جرب: slim -version"
